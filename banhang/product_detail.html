<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Chi ti·∫øt s·∫£n ph·∫©m</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<style>
.thumb img{
    height:80px;
    cursor:pointer;
    border:2px solid transparent;
}
.thumb img.active{border-color:#0d6efd}

.star{
    font-size:22px;
    color:#ccc;
    cursor:pointer;
}
.star.active{color:gold}
</style>
</head>

<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
    <div class="container">
        <a class="navbar-brand fw-bold" href="/banhang/products.html">
            üõçÔ∏è B√°n H√†ng
        </a>
        <div class="ms-auto">
            <a href="/banhang/cart.html"
               class="btn btn-outline-primary position-relative">
                üõí Gi·ªè h√†ng
                <span id="cart-count"
                      class="position-absolute top-0 start-100 translate-middle
                             badge rounded-pill bg-danger">0</span>
            </a>
        </div>
    </div>
</nav>

<div class="container mt-4">

<a href="/banhang/products.html">‚¨Ö Quay l·∫°i</a>

<div class="row mt-3">
    <!-- ·∫¢NH -->
    <div class="col-md-5">
        <img id="main-img" class="img-fluid mb-3">
        <div class="d-flex gap-2 thumb" id="thumbs"></div>
    </div>

    <!-- TH√îNG TIN -->
    <div class="col-md-7">
        <h3 id="name"></h3>
        <p class="text-danger fs-4" id="price"></p>
        <p id="desc"></p>

        <!-- ƒê√ÅNH GI√Å -->
        <div class="mb-3">
            <strong>ƒê√°nh gi√°:</strong>
            <span id="stars">
                <i class="fa fa-star star" data-v="1"></i>
                <i class="fa fa-star star" data-v="2"></i>
                <i class="fa fa-star star" data-v="3"></i>
                <i class="fa fa-star star" data-v="4"></i>
                <i class="fa fa-star star" data-v="5"></i>
            </span>
            <span id="star-text" class="ms-2 text-muted"></span>
        </div>

        <!-- S·ªê L∆Ø·ª¢NG -->
        <div class="mb-3 d-flex align-items-center gap-2">
            <strong>S·ªë l∆∞·ª£ng:</strong>
            <button class="btn btn-outline-secondary btn-sm" id="minus">‚àí</button>
            <input type="number" id="qty" value="1" min="1"
                   class="form-control text-center" style="width:80px">
            <button class="btn btn-outline-secondary btn-sm" id="plus">+</button>
        </div>

        <button id="btn-add-cart" class="btn btn-success">
            üõí Th√™m v√†o gi·ªè h√†ng
        </button>
    </div>
</div>

<h4 class="mt-5">S·∫£n ph·∫©m t∆∞∆°ng t·ª±</h4>
<div class="row" id="related"></div>

</div>

<script>
const id = new URLSearchParams(window.location.search).get("id");
let rating = 0;

/* LOAD CHI TI·∫æT */
$.getJSON(`/banhang/api/product_detail.php?id=${id}`, function (data) {

    $("#name").text(data.product.product_name);
    $("#price").text(Number(data.product.price).toLocaleString()+" ƒë");
    $("#desc").text(data.product.description);

    $("#main-img").attr("src", data.images[0]);

    data.images.forEach((img,i)=>{
        $("#thumbs").append(`
            <img src="${img}" class="${i===0?'active':''}"
                 onclick="
                    $('#main-img').attr('src','${img}');
                    $('.thumb img').removeClass('active');
                    this.classList.add('active');
                 ">
        `);
    });

    let html="";
    data.related.forEach(r=>{
        html+=`
        <div class="col-md-3 mb-3">
            <div class="card h-100">
                <img src="${r.image_url}"
                     class="card-img-top"
                     style="height:180px;object-fit:cover">
                <div class="card-body">
                    <h6>${r.product_name}</h6>
                    <p class="text-danger">${Number(r.price).toLocaleString()} ƒë</p>
                    <a href="/banhang/product_detail.html?id=${r.product_id}"
                       class="btn btn-sm btn-primary w-100">Xem</a>
                </div>
            </div>
        </div>`;
    });
    $("#related").html(html);
});

/* STAR RATING */
$(".star").click(function(){
    rating = $(this).data("v");
    $(".star").removeClass("active");
    $(".star").each(function(){
        if($(this).data("v") <= rating) $(this).addClass("active");
    });
    $("#star-text").text("B·∫°n ƒë√°nh gi√° " + rating + " sao");
});

/* QTY */
$("#plus").click(()=> $("#qty").val(+$("#qty").val()+1));
$("#minus").click(()=>{
    let q = +$("#qty").val();
    if(q>1) $("#qty").val(q-1);
});

/* ADD TO CART */
$("#btn-add-cart").click(function () {
    $.post("/banhang/api/cart.php?action=add", {
        product_id: id,
        qty: $("#qty").val()
    }, function () {
        alert("‚úÖ ƒê√£ th√™m v√†o gi·ªè h√†ng");
        loadCartCount();
    });
});

/* CART COUNT */
function loadCartCount(){
    $.getJSON("/banhang/api/cart.php?action=list", function (data) {
        let total = 0;
        data.forEach(p => total += parseInt(p.qty));
        $("#cart-count").text(total);
    });
}
$(function(){ loadCartCount(); });
</script>

</body>
</html>
